{% extends "base.html" %}
{% load thumbnail pagination html %}

{% block content %}
{% paginate episodes as page_obj %}
{% if page_obj.number == 1 and not search %}
<div class="p-2 border border-gray-400 mb-3">

  <h2 class="font-bold mb-3 text-lg">{{ podcast.title }}</h2>
  {% if podcast.authors %}
  <h3 class="font-semibold text-gray-700 mb-3">{{ podcast.authors }}</h3>
  {% endif %}

  <div class="flex items-center w-full mb-3">

    {% thumbnail podcast.cover_image "200" format="PNG" crop="center" as img %}
    <img src="{{ img.url }}"
         alt="{{ podcast.title }}"
         class="object-cover mr-4 h-24 w-24 sm:h-32 sm:w-32"
         width="32"
         height="32">
    {% endthumbnail %}

    <div>

      <div class="font-semibold text-gray-700 flex flex-wrap items-center mb-3">
        <div class="inline-block mr-2">{{ podcast.pub_date|date }}</div>
      </div>

      <div class="flex items-center mb-3">
        {% if podcast.link %}
        <a href="{{ podcast.link }}"
           class="text-blue-800 hover:text-blue-600 mr-2"
           target="_blank"
           rel="noopener">Website</a>
        {% endif %}
        <a href="{{ podcast.rss }}"
           class="text-blue-800 hover:text-blue-600 mr-2"
           target="_blank"
           rel="noopener">RSS</a>
        <a href="{{ podcast.itunes }}"
           class="text-blue-800 hover:text-blue-600 mr-2"
           target="_blank"
           rel="noopener">iTunes</a>
      </div>
    </div>

  </div>

  <div class="mb-3">
    {% if user.is_authenticated %}
    {% if is_subscribed %}
    <button data-controller="ajax"
            data-ajax-url-value="{% url 'podcasts:unsubscribe' podcast.id %}"
            data-action="click->ajax#post:once"
            class="px-2 py-1 border rounded hover:bg-gray-100">
      <i class="fa fa-eye-slash mr-2"></i>
      Unsubscribe
    </button>
    {% else %}
    <button data-controller="ajax"
            data-ajax-url-value="{% url 'podcasts:subscribe' podcast.id %}"
            data-action="click->ajax#post:once"
            class="px-2 py-1 border rounded hover:bg-gray-100">
      <i class="fa fa-eye mr-2"></i>
      Subscribe
    </button>
    {% endif %}
    {% endif %}
  </div>

  <div class="markdown mb-3">
    {{ podcast.description|clean_html }}
  </div>
  <div>
    {% for category in podcast.categories.all %}
    <a class="inline-block bg-indigo-800 hover:bg-indigo-600 text-white px-2 py-1 rounded mr-3 mb-1 text-sm font-semibold"
       href="{{ category.get_absolute_url }}">
      <i class="fa fa-tag mr-1"></i>
      {{ category.name }}
    </a>
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="md:flex justify-between items-center mb-3">
  <h2 class="text-lg font-bold mb-3 md:mb-0">Episodes</h2>
  {% include "_search_form.html" with placeholder="Search episodes" %}
</div>


{% if page_obj.number > 1 %}
{% include "_pagination.html" with css_class="mb-3"  %}
{% endif %}

{% for episode in page_obj %}
{% include "episodes/_episode.html" with show_thumbnail=False %}
{% endfor %}

{% include "_pagination.html" %}
{% endblock %}
